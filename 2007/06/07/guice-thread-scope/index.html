<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Guice Thread Scope</title>
    <link rel="stylesheet" type="text/css" href="/style.css">
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-38858050-1']);
      _gaq.push(['_trackPageview']);
      (function() {
       var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
       ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
       var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
       })();
    </script>
  </head>
  <body>
    <div class="body">
      <div class="header">
        <div class="title">
          <a href="/">Robbie&#39;s Garbage, Collected.</a>
        </div>
      </div>
      <div class="blog">
        <h1>Guice Thread Scope</h1>
        <div class="date">June 7, 2007</div>
        <div class="entry"><strong>UPDATE</strong>: The reset thing turned out to be a bad idea, I created <a href="http://code.google.com/p/google-guice/issues/detail?id=114">simple Thread Scope</a> instead. If you somehow seem to need a reset, consider <a href="http://code.google.com/p/google-guice/wiki/Scopes">this</a>.<br><br>Ever wanted to use <a href="http://code.google.com/p/google-guice/" title="Google Guice">Guice</a>'s request scope outside of a web application? Try out <a href="http://code.google.com/p/google-guice/issues/attachment?aid=-4210064442097121541&amp;name=GuiceThreadScope.txt">my thread scope implementation</a> and let me know what you think. <a href="http://code.google.com/p/google-guice/issues/detail?id=100">Cast your vote</a> if you want to see this scope added to Guice.<br><br>Here's an example. Create a <code>Module</code> that looks like this:<br><pre><br>Injector i = Guice.createInjector(new Module() {<br>    public void configure(Binder binder) {<br>        binder.bindScope(ThreadScoped.class, CustomScopes.THREAD);<br>        binder.bind(ThreadCache.class).in(Scopes.SINGLETON);<br>        // add your custom classes<br>        binder.bind(SomeClass.class).in(CustomScopes.THREAD);<br>    }<br>});</pre><br>Each thread is automatically initialized for the scope. To reset it, use the <code>ThreadCache</code>:<br><pre>@Inject private ThreadCache threadCache<br>public void someMethod() {<br>    try {<br>        // do stuff in thread scope<br>    } finally {<br>        threadCache.reset();<br>    }<br>}</pre><br>I'm thinking about loading this scope's initialization code lazily (so that you'll need to execute <code>threadCache.start()</code> or something like that). It currently doesn't matter for me and the memory overhead is low anyway, but what do you think?<br><br>PS: only use field injection for examples ;-)</div>
      </div>
    </div>
  </body>
</html>
